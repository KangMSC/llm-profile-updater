# Gemini CLI Project Log

## 2025년 10월 5일

- 프로젝트 시작
- `project-log.md` 생성
- 프로젝트 상태 파악
- `src/db.js`의 `getActorUUID` 함수에서 발생하는 숫자 정밀도 손실 버그 수정.
  - 원인: JavaScript의 `Number.MAX_SAFE_INTEGER`를 초과하는 `uuid` 값을 숫자로 처리하려다 발생.
  - 해결: SQL 쿼리에서 `CAST(uuid AS TEXT)`를 사용하여 `uuid`를 문자열로 가져오도록 수정.

---

## 프로젝트 분석 (2025-10-05)

### 1. 프로젝트 목적
- Skyrim 게임 내 캐릭터의 '기억(memories)' 데이터를 기반으로, LLM(AI 모델)을 사용하여 캐릭터의 성격, 최근 경험, 관계 등을 요약한 상세 프로필을 자동으로 생성하고 업데이트하는 Node.js 애플리케이션.

### 2. 핵심 동작 흐름
1.  `.env` 파일에 정의된 캐릭터 목록(`CHARACTER_NAMES`)을 읽어옴.
2.  각 캐릭터에 대해 SQLite 데이터베이스에 연결하여 고유 ID(`uuid`)와 기억 목록(`memories`)을 조회.
3.  조회된 기억들을 OpenRouter API를 통해 LLM에게 전달.
4.  LLM은 기억들을 바탕으로 새로운 캐릭터 프로필을 생성.
5.  생성된 프로필을 콘솔에 출력.

### 3. 주요 구성 요소
-   **`main.js`**: 전체 작업을 조율하는 메인 로직.
-   **`db.js`**: SQLite 데이터베이스 연결 및 데이터 조회/수정 담당.
-   **`llm.js`**: OpenRouter API와 통신하여 LLM을 통해 프로필 생성을 요청.
-   **`config.js`**: `.env` 파일에서 API 키, DB 경로 등 환경 변수를 불러와 관리.
-   **`db/schema.sql`**: `memories`, `events`, `uuid_mappings` 등 데이터베이스의 전체 테이블 구조를 정의.

### 4. 설정 (`.env` 파일)
-   `OPENROUTER_API_KEY`: OpenRouter API 사용을 위한 필수 키.
-   `DATABASE_PATH`: SQLite 데이터베이스 파일의 경로.
-   `CHARACTER_NAMES`: 프로필을 업데이트할 캐릭터 이름 목록 (쉼표로 구분).

### 5. 현 상태 및 다음 단계
-   현재 캐릭터의 기억을 읽어와 LLM을 통해 새 프로필을 생성하고 콘솔에 출력하는 기능까지 구현되어 있음.
-   `main.js`에 `// TODO: Save the new profile to the database` 주석이 명시된 바와 같이, 생성된 프로필을 다시 데이터베이스에 저장하는 기능이 구현되어야 함.

---

## 2025년 10월 5일 (오후) - 주요 기능 추가 및 버그 수정

### 기능 추가 및 변경사항
1.  **프로필 관리 시스템 개편**:
    -   LLM이 단순 텍스트 프로필을 생성하던 방식에서, 캐릭터별 `json` 파일을 읽고 최신 기억에 따라 내용을 "업데이트"하는 방식으로 변경.
    -   `profiles` 디렉토리를 추가하여 캐릭터의 `json` 프로필을 관리.

2.  **HTML 웹 인터페이스 구현**:
    -   업데이트된 프로필을 보여주는 정적 HTML 웹페이지를 생성하는 기능 추가.
    -   `public` 디렉토리에 각 캐릭터의 상세 페이지(`<캐릭터명>.html`)와 전체 목록 페이지(`index.html`)가 생성됨.
    -   `public/style.css`를 추가하여 기본적인 웹페이지 스타일링 적용.

3.  **웹 서버 추가**:
    -   `server.js` 파일을 추가하여 `public` 디렉토리의 HTML 파일들을 서비스하는 간단한 Node.js 웹 서버를 구현.
    -   `package.json`에 `npm start`로 서버를 실행할 수 있는 스크립트 추가.

4.  **LLM 설정 및 프롬프트 개선**:
    -   LLM 모델을 `.env` 파일에서 설정(`LLM_MODEL`)할 수 있도록 `config.js`와 `llm.js` 수정.
    -   LLM이 항상 한국어로 응답하고, 주어진 JSON 구조에 맞춰 결과물을 반환하도록 프롬프트를 대폭 수정.

### 버그 수정
1.  **`[object Object]` 표시 오류**: 웹페이지에서 `likesAndDislikes` 항목이 객체 형태로 되어 있을 경우, 내용 대신 `[object Object]`로 표시되던 문제를 해결. (`src/main.js`)
2.  **한글 파일명 404 오류**: `신미어` 등 한글 이름으로 된 캐릭터 페이지에 접근 시 404 Not Found가 발생하던 문제를 해결. URL 인코딩을 디코딩하도록 웹 서버 로직 수정. (`server.js`)
3.  **파일 손상 오류**: 이전 작업 중 `src/llm.js` 파일 내용이 손상되었던 문제를 복구.

---

## 2025년 10월 8일 - 동적 웹 애플리케이션 전환 및 기능 개선

### 주요 변경사항

1.  **동적 웹 애플리케이션으로 전환**:
    -   기존 정적 HTML(`public/*.html`) 파일을 생성/제공하던 방식에서, Express.js 서버가 모든 페이지를 동적으로 렌더링하는 방식으로 완전히 전환했습니다.
    -   `express.static`과 동적 라우트의 충돌 문제를 해결하기 위해 기존의 정적 캐릭터 `html` 파일들을 삭제했습니다.
    -   인라인 스크립트를 `public/js/character-page.js`로 분리하고, 브라우저 캐시 문제를 해결하기 위해 캐시 무력화(cache-busting) 쿼리 파라미터를 적용했습니다.

2.  **데이터 소스 변경 (`memories` -> `events`)**:
    -   `memories` 테이블의 신뢰성 문제로, 프로필 업데이트의 기반 데이터를 `events` 테이블로 변경했습니다.
    -   이에 맞춰 `db.js`, `llm.js`, `main.js`의 관련 로직을 모두 수정했습니다.

3.  **UI를 통한 상호작용 기능 추가**:
    -   CLI에서 `main.js`를 실행하는 대신, 웹 페이지에서 직접 프로필을 업데이트하고 일지를 생성할 수 있는 버튼을 추가했습니다.
    -   이를 위해 `server.js`에 `/api/profiles/:characterName/update` 등 새로운 API 엔드포인트를 구현했습니다.
    -   `main.js`와 `diary.js`의 핵심 로직을 모듈화하여 API 엔드포인트에서 호출할 수 있도록 구조를 변경했습니다.

4.  **사용자 경험(UX) 개선**:
    -   프로필이 없는 캐릭터에 접근 시, 단순 에러 페이지가 아닌 프로필 생성이 가능한 '셸(shell)' 페이지를 보여주도록 로직을 개선하고 있습니다.
    -   메인 페이지의 캐릭터 목록은 `.env` 파일에 정의된 모든 캐릭터를 보여주도록 변경 중입니다.

### 버그 수정

1.  **일지 모달 오류 수정**: 일지 링크 클릭 시 새 탭이 열리던 버그의 근본 원인(정적 파일과 동적 라우트 충돌)을 찾아 해결했습니다.
2.  **LLM 프롬프트 오류 수정**: `llm.js`에서 줄바꿈 문자가 잘못 처리되어 발생하던 구문 오류를 수정했습니다.

---

## 2025년 10월 8일 (오후) - 버그 수정 및 UI 개선

### 버그 수정

1.  **프로필 `.txt` 파일 생성 오류 해결**:
    -   **문제**: `generated-profiles` 디렉터리가 없는 상태에서 프로필 업데이트 시, `.txt` 파일 생성을 시도하다 `ENOENT` (파일/디렉터리 없음) 오류가 발생했습니다. 이는 `main.js`의 `processCharacter` 함수가 `main` 함수와 독립적으로 호출될 때 디렉터리 생성 로직이 실행되지 않았기 때문입니다.
    -   **해결**: `src/main.js`의 `processCharacter` 함수 내에서 파일을 쓰기 직전에 `fs.mkdir`를 호출하여 상위 디렉터리의 존재를 보장하도록 수정했습니다. 이로써 함수의 독립성이 향상되고 오류가 해결되었습니다.

### UI 개선

1.  **캐릭터 프로필 페이지 표시 정보 확장**:
    -   **문제**: 기존 캐릭터 페이지에서는 `summary`, `appearance` 등 일부 정보만 표시되어, 최근 10개 필드로 확장된 프로필의 모든 내용을 확인할 수 없었습니다.
    -   **해결**: `server.js`의 캐릭터 페이지 렌더링 로직을 대폭 수정했습니다. 모든 프로필 필드(요약, 배경, 성격, 관계 등 10개)를 동적으로 렌더링하는 `renderProfileHtml` 함수를 구현하여, 하드코딩된 기존 섹션을 대체했습니다.

---

## 2025년 10월 8일 (저녁) - 프로필 업데이트 고도화

### 기능 추가

1.  **필드별 프로필 업데이트 지침 기능 구현**:
    -   **목표**: LLM이 프로필을 업데이트할 때, 각 필드(예: `relationships`, `summary`)에 대해 사용자가 원하는 특정 방향이나 제약사항을 따르도록 제어 기능을 추가했습니다.
    -   **구현 내용**:
        1.  **`profile-instructions.json` 파일 추가**: 프로젝트 루트에 지침을 저장하기 위한 `json` 파일을 생성했습니다. 사용자는 이 파일에 캐릭터별, 필드별로 상세한 업데이트 지침을 작성할 수 있습니다.
        2.  **`llm.js` 프롬프트 수정**: `updateCharacterProfile` 함수가 `instructions` 객체를 인자로 받도록 수정했습니다. 전달된 지침이 있을 경우, 프롬프트 내에 "중요 지침" 섹션을 동적으로 생성하여 LLM이 명확하게 인지하고 따르도록 했습니다.
        3.  **`main.js` 로직 수정**: `processCharacter` 함수가 `profile-instructions.json` 파일을 읽어, 현재 처리 중인 캐릭터에 대한 지침을 `updateCharacterProfile` 함수로 전달하도록 로직을 추가했습니다. 파일이 없거나 형식이 잘못된 경우에도 안전하게 동작하도록 예외 처리를 포함했습니다.

---

## 2025년 10월 8일 (밤) - 일기 생성 기능 개선

### 기능 추가

1.  **일기 생성 시 캐릭터 프로필 참조 기능**:
    -   **목표**: LLM이 일기를 작성할 때 캐릭터의 성격, 배경, 관계 등을 더 잘 반영하여 깊이 있는 결과물을 만들도록 개선했습니다.
    -   **구현 내용**:
        1.  **`diary.js` 수정**: 일기 생성 프로세스(`processCharacterForDiary`)가 시작될 때, 해당 캐릭터의 `json` 프로필을 먼저 읽어오도록 수정했습니다.
        2.  **`llm.js` 프롬프트 수정**: `generateCharacterDiary` 함수가 캐릭터 프로필 `json`을 인자로 받아 프롬프트에 포함시키도록 변경했습니다.

---

## 2025년 10월 9일 - 동적 커스텀 프로필 필드 기능 구현

### 기능 추가

1.  **커스텀 프로필 필드 지원**:
    -   **목표**: 사용자가 `profile-instructions.json`에 새로운 필드를 정의하면, 해당 필드가 캐릭터 프로필에 동적으로 추가되고 내용이 생성되도록 기능을 확장했습니다.
    -   **구현 내용**:
        1.  **`main.js` (프로필 프라이밍)**: 프로필 업데이트 시 `profile-instructions.json`을 읽어 기존 프로필에 없는 새로운 키가 발견되면, 이를 커스텀 필드로 간주하여 '정보 없음' 또는 `[]` 같은 기본값으로 프로필 객체에 먼저 추가합니다.
        2.  **`llm.js` (동적 프롬프트)**: LLM에 요청하는 프롬프트가 더 이상 고정된 필드 목록을 사용하지 않습니다. 대신 `main.js`에서 전달받은 프로필 객체의 모든 키(커스텀 필드 포함)를 동적으로 목록화하여, LLM이 유연한 구조에 맞춰 결과물을 생성하도록 수정했습니다.
        3.  **`main.js` & `server.js` (동적 출력)**: `.txt` 프로필을 생성하는 `formatProfileToTxt` 함수와 웹 페이지를 렌더링하는 `renderProfileHtml` 함수가 고정된 필드 목록 대신, 최종 프로필 객체에 있는 모든 키를 순회하도록 변경했습니다.

---

## 2025년 10월 9일 (오후) - LLM 응답 오류 처리 개선

### 기능 개선

1.  **LLM 응답 파싱 오류 처리**:
    -   **문제**: LLM이 가끔 유효하지 않은 JSON(예: 마크다운 코드 블록으로 감싸진 JSON)을 반환하여 `JSON.parse()`에서 `SyntaxError`를 발생시키고 프로세스가 중단될 수 있었습니다.
    -   **해결**:
        1.  **자동 수정 시도**: `JSON.parse()`를 호출하기 전에, 응답에서 ` ```json ` 과 같은 마크다운 블록을 자동으로 제거하는 단계를 추가했습니다.
        2.  **오류 로깅**: 자동 수정 후에도 파싱에 실패할 경우, 더 이상 프로세스를 중단하지 않습니다. 대신, 오류 메시지를 콘솔에 기록하고, LLM이 보낸 원본 응답을 `logs/failed_responses` 디렉터리에 `캐릭터명-타임스탬프.log` 파일로 저장하여 나중에 분석할 수 있도록 했습니다.
        3.  **프로세스 계속**: 오류를 기록한 후, 해당 캐릭터의 업데이트는 건너뛰고 다음 캐릭터로 넘어가 전체 작업이 중단되지 않도록 수정했습니다.

---

## 2025년 10월 9일 (밤) - .txt 프로필 포맷 수정

### 기능 개선

1.  **`.txt` 프로필 하이브리드 포맷 적용**:
    -   **목표**: `generated-profiles`에 생성되는 `.txt` 파일이 상위 프로그램과 호환되도록 포맷을 수정했습니다.
    -   **구현 내용**: `src/main.js`의 `formatProfileToTxt` 함수를 수정하여, 프로필 필드를 두 종류로 나누어 처리하도록 변경했습니다.
        -   **기본 필드**: `summary`, `personality` 등 기존 필드들은 상위 프로그램 호환성을 위해 `{% block %}` 구문을 그대로 유지합니다.
        -   **커스텀 필드**: `profile-instructions.json`을 통해 새로 추가된 필드들은, 기본 필드들 다음에 `---` 구분선과 함께 `### 필드명` 형태의 가독성 좋은 마크다운 형식으로 추가됩니다.

---

## 2025년 10월 9일 (심야) - Stable Diffusion 연동 및 이미지 관리 시스템 고도화

### 기능 추가 및 개선

1.  **Stable Diffusion 설정 통합**:
    *   `STABLE_DIFFUSION_LORA` 환경 변수를 `.env.example`에 추가하고 `src/config.js`에서 이를 읽도록 설정했습니다.
    *   `src/llm.js`의 `generateSdPrompt` 함수가 생성된 프롬프트에 LoRA 태그를 자동으로 추가하도록 수정했습니다.
    *   `ui-config.json` 파일을 수정하여 WebUI의 `txt2img` 및 `img2img` 탭에 "최고 품질 Photo 모드" 및 "캐릭터 일관성 유지"를 위한 기본 설정값을 반영했습니다.
        *   **`txt2img` 기본값**: Sampler: `LCM`, Scheduler: `Exponential`, Steps: `8`, Width: `832`, Height: `1216`, CFG Scale: `1.0`, Prompt: `<lora:dmd2_sdxl_4step_lora_fp16:1>`
        *   **`img2img` 기본값**: Sampler: `LCM`, Scheduler: `Exponential`, Steps: `6`, CFG Scale: `1.0`, Denoising strength: `0.6`, Prompt: `<lora:dmd2_sdxl_4step_lora_fp16:1>`

2.  **이미지 관리 시스템 리팩토링**:
    *   `multer` 라이브러리를 설치하여 파일 업로드 기능을 강화했습니다.
    *   `server.js`를 수정하여:
        *   업로드된 이미지가 `public/images/characters/<캐릭터이름>/` 하위 디렉토리에 타임스탬프 기반 파일명으로 저장되도록 `multer` 설정을 변경했습니다.
        *   새로운 API 엔드포인트 `POST /api/characters/:characterName/upload-image`를 추가하여 이미지 업로드를 처리하고, JSON 프로필을 수정하지 않고 파일 시스템에 직접 저장하도록 했습니다.
        *   캐릭터 페이지 라우트(`GET /characters/:characterName`)를 리팩토링하여, 캐릭터의 이미지 디렉토리를 스캔하여 메인 프로필 이미지와 이미지 히스토리를 동적으로 결정하도록 했습니다.
        *   가장 최신 이미지(타임스탬프 기준)가 메인 이미지로 표시되고, 나머지 이미지들은 최신순으로 정렬되어 히스토리 갤러리에 표시되며, 디스크에 실제로 존재하는 이미지들만 활용하도록 했습니다.
        *   "No Image" 플레이스홀더를 제거하여, 유효한 이미지가 없을 경우 빈 컨테이너를 표시하도록 했습니다.

3.  **기존 이미지 생성 기능 제거**:
    *   더 이상 사용하지 않는 API 기반 이미지 생성 기능을 제거했습니다.
    *   `server.js`에서 "Regenerate Image" 버튼 HTML과 `POST /api/images/:characterName/generate` 엔드포인트를 삭제했습니다.
    *   `public/js/character-page.js`에서 관련 클라이언트 측 JavaScript 코드를 제거했습니다.

### 버그 수정

1.  **`SyntaxError: Identifier 'profileHtml' has already been declared` 해결**: `server.js`에서 `profileHtml` 변수의 중복 선언을 제거하여 구문 오류를 해결했습니다.
2.  **`ReferenceError: renderProfileHtml is not defined` 해결**: `server.js`에서 `renderProfileHtml` 함수 정의가 실수로 제거되었던 것을 다시 삽입하여 참조 오류를 해결했습니다.

---

## 2025년 10월 9일 (심야) - UI/UX 개선 및 추가 기능 구현

### 기능 추가 및 개선

1.  **UI/레이아웃 재구성 (3단 컬럼)**:
    *   화면 가로 길이를 확장하고 캐릭터 상세 페이지를 3단 컬럼 레이아웃으로 재구성했습니다.
    *   **왼쪽 컬럼**: 이미지 관련 콘텐츠 (메인 이미지, 업로드 폼, 이미지 히스토리)
    *   **중간 컬럼**: 프로필 콘텐츠
    *   **오른쪽 컬럼**: 일기 관련 콘텐츠 (일기 목록, 일기 생성 버튼, SD 프롬프트 생성)
    *   `server.js`의 HTML 구조와 CSS를 수정하여 새로운 레이아웃을 적용했습니다.

2.  **이미지 히스토리 갤러리 기능 강화**:
    *   히스토리 갤러리 썸네일 클릭 시 원본 이미지를 볼 수 있는 모달(lightbox) 기능을 구현했습니다.
    *   모달 내에서 좌우 탐색 버튼을 통해 히스토리 이미지를 넘겨볼 수 있도록 했습니다.
    *   `server.js`에 이미지 갤러리 모달 HTML을 추가하고 `imageHistoryForDisplay` 데이터를 클라이언트 측으로 전달하도록 수정했습니다.
    *   `public/js/character-page.js`에 이미지 갤러리 모달의 클라이언트 측 로직(모달 열기, 탐색, 닫기)을 구현했습니다.

3.  **일기 기능 개선**:
    *   일기 항목을 파일 생성일 기준으로 날짜순(오래된 것부터 최신순)으로 정렬하도록 `server.js`의 `/api/diaries/:characterName` 엔드포인트를 수정했습니다.
    *   일기 모달 내에서 좌우 탐색 버튼을 통해 일기 항목을 넘겨볼 수 있도록 했습니다.
    *   `server.js`의 일기 모달 HTML에 탐색 버튼을 추가했습니다.
    *   `public/js/character-page.js`에 일기 탐색을 위한 클라이언트 측 로직(정렬된 일기 항목 가져오기, 모달 열기, 탐색, 닫기)을 구현했습니다.

### 버그 수정

1.  **Stable Diffusion 이미지 잘림 현상 해결**:
    *   업로드된 Stable Diffusion 이미지가 잘려 보이던 문제를 해결했습니다.
    *   `server.js`의 CSS에서 `.character-image-container`의 `aspect-ratio`를 제거하고, `.character-image-container img`의 `object-fit`을 `contain`으로 변경하여 이미지가 잘리지 않고 비율을 유지하며 표시되도록 했습니다.
2.  **일기 모달 탐색 버튼 위치 오류 수정**:
    *   일기 모달의 좌우 탐색 버튼이 텍스트를 가리거나 잘못된 위치에 표시되던 문제를 해결했습니다.
    *   `server.js`의 HTML에서 탐색 버튼을 `.modal-content` 내부로 다시 이동시키고, `#modal-body`를 `#modal-body-wrapper`로 감싸 스크롤을 제어하도록 했습니다.
    *   CSS를 조정하여 `.modal-content`를 플렉스 컨테이너로 만들고, `#modal-body-wrapper`에 스크롤과 패딩을 적용하여 버튼이 텍스트와 겹치지 않으면서 올바르게 수직 중앙에 위치하도록 수정했습니다.

---

## 2025년 10월 9일 (자정) - UI 설정 및 이벤트 조회 로직 개선

### 기능 추가 및 개선

1.  **Stable Diffusion UI 기본값 설정 파일 추가**:
    *   `ui-config.json` 파일을 프로젝트에 추가하여, Stable Diffusion WebUI의 각 탭(txt2img, img2img 등)과 세부 파라미터에 대한 기본값을 중앙에서 관리하도록 했습니다. 이는 일관된 이미지 생성 환경을 제공하기 위함입니다.
    *   IntelliJ IDEA의 프로젝트 설정(`.iml`) 파일을 수정하여 `diaries`, `profiles` 등 동적으로 생성되는 데이터 폴더를 프로젝트 뷰에서 제외하도록 변경했습니다.

2.  **이벤트 조회 로직 정교화**:
    *   **문제**: 기존에는 프로필 업데이트 시 캐릭터의 모든 과거 이벤트를 불러와 LLM에 전달했기 때문에, 불필요하게 많은 토큰을 사용하고 최신 정보와 관련 없는 내용까지 포함될 수 있었습니다.
    *   **해결**: `src/db.js`의 `getCharacterEvents` 함수를 수정하여, 캐릭터의 **가장 마지막 이벤트가 발생한 날짜를 기준으로 그 이전 2일 동안의 이벤트만** 가져오도록 변경했습니다. 이를 통해 더 관련성 높은 최신 정보를 바탕으로 프로필을 업데이트할 수 있게 되었습니다.

---

## 2025년 10월 11일 - 최초 프로필 생성 기능 구현

### 기능 추가

1.  **최초 프로필 생성 기능**:
    *   **목표**: 사용자가 제공하는 간단한 설명이나 키워드를 바탕으로 LLM을 통해 캐릭터의 전체 프로필을 처음부터 생성하는 기능을 추가했습니다. 이 기능은 기존 프로필 유무와 관계없이 사용할 수 있습니다.
    *   **구현 내용**:
        1.  **UI 추가**: 캐릭터 페이지의 'Actions' 섹션에 'Initial Profile Generation' 영역을 추가하고, 방향성 지시를 위한 텍스트 입력창과 'Generate Initial Profile' 버튼을 배치했습니다 (`server.js`).
        2.  **API 엔드포인트 추가**: `POST /api/profiles/:characterName/generate` 엔드포인트를 `server.js`에 새로 구현했습니다. 이 엔드포인트는 사용자 입력을 받아 LLM을 호출하고, 반환된 JSON 프로필을 `profiles/<캐릭터명>.json` 파일에 저장(또는 덮어쓰기)합니다.
        3.  **LLM 프롬프트 로직 추가**: `src/llm.js`에 `generateInitialProfile` 함수를 새로 작성했습니다. 이 함수는 `profile-instructions.json`을 참조하여 필요한 모든 키가 포함된 JSON 구조를 생성하도록 LLM에 요청하는 프롬프트를 동적으로 구성합니다.
        4.  **클라이언트 로직 추가**: `public/js/character-page.js`에 버튼 클릭 시 서버로 비동기 요청을 보내고 상태 메시지를 표시하며, 성공 시 페이지를 새로고침하는 로직을 추가했습니다.

### 버그 수정

1.  **`SyntaxError` 해결**:
    *   **문제**: `src/llm.js`의 `generateInitialProfile` 함수 내 프롬프트 문자열에 이스케이프 처리되지 않은 백틱(`)이 포함되어 있어 `SyntaxError: Unexpected token ']'` 오류가 발생했습니다.
    *   **해결**: 프롬프트 내 예시로 사용된 `[]`를 감싸는 백틱을 이스케이프 처리하여 (`\`[]\``) 구문 오류를 해결했습니다.

2.  **`ENOENT` 오류 해결**:
    *   **문제**: `profiles` 디렉터리가 없는 상태에서 최초 프로필 생성을 시도하면, 파일을 쓸 경로가 없어 `ENOENT: no such file or directory` 오류가 발생했습니다.
    *   **해결**: `server.js`의 프로필 생성 API 로직에서 `fs.writeFile`을 호출하기 직전에 `fs.mkdir(PROFILES_DIR, { recursive: true })`를 추가하여, 디렉터리가 항상 존재하도록 보장했습니다.
